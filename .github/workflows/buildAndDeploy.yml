name: Deploy Carveo

on:
  push:
    branches: [ main ]  # or your default branch

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
    - name: Clean workspace with proper permissions
      run: |
        sudo chown -R ubuntu:ubuntu /home/ubuntu/actions-runner/_work/Carveo/Carveo/ || true
        sudo chmod -R 755 /home/ubuntu/actions-runner/_work/Carveo/Carveo/ || true
        sudo rm -rf /home/ubuntu/actions-runner/_work/Carveo/Carveo/* || true
    
    - uses: actions/checkout@v4
    
    - name: Set up permissions after checkout
      run: |
        sudo chown -R ubuntu:ubuntu .
        sudo chmod -R 755 .
        
    - name: Docker compose up
      run: |
        docker compose up -d